{
  "definitionName": "ufnGetContactInformation",
  "schemaName": "dbo",
  "definition": "CREATE FUNCTION [dbo].[ufnGetContactInformation](@PersonID int)\nRETURNS @retContactInformation TABLE \n(\n    -- Columns returned by the function\n    [PersonID] int NOT NULL, \n    [FirstName] [nvarchar](50) NULL, \n    [LastName] [nvarchar](50) NULL, \n    [JobTitle] [nvarchar](50) NULL,\n    [BusinessEntityType] [nvarchar](50) NULL\n)\nAS \n-- Returns the first name, last name, job title and business entity type for the specified contact.\n-- Since a contact can serve multiple roles, more than one row may be returned.\nBEGIN\n    IF @PersonID IS NOT NULL \n        BEGIN\n        IF EXISTS(SELECT * FROM [HumanResources].[Employee] e \n                    WHERE e.[BusinessEntityID] = @PersonID) \n            INSERT INTO @retContactInformation\n                SELECT @PersonID, p.FirstName, p.LastName, e.[JobTitle], 'Employee'\n                FROM [HumanResources].[Employee] AS e\n                    INNER JOIN [Person].[Person] p\n                    ON p.[BusinessEntityID] = e.[BusinessEntityID]\n                WHERE e.[BusinessEntityID] = @PersonID;\n\n        IF EXISTS(SELECT * FROM [Purchasing].[Vendor] AS v\n                    INNER JOIN [Person].[BusinessEntityContact] bec \n                    ON bec.[BusinessEntityID] = v.[BusinessEntityID]\n                    WHERE bec.[PersonID] = @PersonID)\n            INSERT INTO @retContactInformation\n                SELECT @PersonID, p.FirstName, p.LastName, ct.[Name], 'Vendor Contact' \n                FROM [Purchasing].[Vendor] AS v\n                    INNER JOIN [Person].[BusinessEntityContact] bec \n                    ON bec.[BusinessEntityID] = v.[BusinessEntityID]\n                    INNER JOIN [Person].ContactType ct\n                    ON ct.[ContactTypeID] = bec.[ContactTypeID]\n                    INNER JOIN [Person].[Person] p\n                    ON p.[BusinessEntityID] = bec.[PersonID]\n                WHERE bec.[PersonID] = @PersonID;\n        \n        IF EXISTS(SELECT * FROM [Sales].[Store] AS s\n                    INNER JOIN [Person].[BusinessEntityContact] bec \n                    ON bec.[BusinessEntityID] = s.[BusinessEntityID]\n                    WHERE bec.[PersonID] = @PersonID)\n            INSERT INTO @retContactInformation\n                SELECT @PersonID, p.FirstName, p.LastName, ct.[Name], 'Store Contact' \n                FROM [Sales].[Store] AS s\n                    INNER JOIN [Person].[BusinessEntityContact] bec \n                    ON bec.[BusinessEntityID] = s.[BusinessEntityID]\n                    INNER JOIN [Person].ContactType ct\n                    ON ct.[ContactTypeID] = bec.[ContactTypeID]\n                    INNER JOIN [Person].[Person] p\n                    ON p.[BusinessEntityID] = bec.[PersonID]\n                WHERE bec.[PersonID] = @PersonID;\n\n        IF EXISTS(SELECT * FROM [Person].[Person] AS p\n                    INNER JOIN [Sales].[Customer] AS c\n                    ON c.[PersonID] = p.[BusinessEntityID]\n                    WHERE p.[BusinessEntityID] = @PersonID AND c.[StoreID] IS NULL) \n            INSERT INTO @retContactInformation\n                SELECT @PersonID, p.FirstName, p.LastName, NULL, 'Consumer' \n                FROM [Person].[Person] AS p\n                    INNER JOIN [Sales].[Customer] AS c\n                    ON c.[PersonID] = p.[BusinessEntityID]\n                    WHERE p.[BusinessEntityID] = @PersonID AND c.[StoreID] IS NULL; \n        END\n\n    RETURN;\nEND;",
  "xType": "TF",
  "type": "FUNCTION"
}