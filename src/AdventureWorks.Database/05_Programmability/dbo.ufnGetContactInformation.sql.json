{
  "definitionName": "ufnGetContactInformation",
  "schemaName": "dbo",
  "definition": "CREATE FUNCTION [dbo].[ufnGetContactInformation]\n(@PersonID INT)\nRETURNS \n    @retContactInformation TABLE (\n        [PersonID] INT NOT NULL,\n        [FirstName] NVARCHAR (50) NULL,\n        [LastName] NVARCHAR (50) NULL,\n        [JobTitle] NVARCHAR (50) NULL,\n        [BusinessEntityType] NVARCHAR (50) NULL)\nAS\nBEGIN\n    IF @PersonID IS NOT NULL\n        BEGIN\n            IF EXISTS (SELECT\n                           *\n                       FROM  \n                           [HumanResources].[Employee] AS e WHERE\n                                                                 e.[BusinessEntityID] = @PersonID)\n                INSERT INTO @retContactInformation\n                SELECT\n                    @PersonID,\n                    p.FirstName,\n                    p.LastName,\n                    e.[JobTitle],\n                    'Employee'\n                FROM  \n                    [HumanResources].[Employee] AS e INNER JOIN\n                    [Person].[Person] AS p ON\n                         p.[BusinessEntityID] = e.[BusinessEntityID] WHERE\n                                                                          e.[BusinessEntityID] = @PersonID;\n            IF EXISTS (SELECT\n                           *\n                       FROM  \n                           [Purchasing].[Vendor] AS v INNER JOIN\n                           [Person].[BusinessEntityContact] AS bec ON\n                                bec.[BusinessEntityID] = v.[BusinessEntityID] WHERE\n                                                                                   bec.[PersonID] = @PersonID)\n                INSERT INTO @retContactInformation\n                SELECT\n                    @PersonID,\n                    p.FirstName,\n                    p.LastName,\n                    ct.[Name],\n                    'Vendor Contact'\n                FROM  \n                    [Purchasing].[Vendor] AS v INNER JOIN\n                    [Person].[BusinessEntityContact] AS bec ON\n                         bec.[BusinessEntityID] = v.[BusinessEntityID] INNER JOIN\n                    [Person].ContactType AS ct ON\n                         ct.[ContactTypeID] = bec.[ContactTypeID] INNER JOIN\n                    [Person].[Person] AS p ON\n                         p.[BusinessEntityID] = bec.[PersonID] WHERE\n                                                                    bec.[PersonID] = @PersonID;\n            IF EXISTS (SELECT\n                           *\n                       FROM  \n                           [Sales].[Store] AS s INNER JOIN\n                           [Person].[BusinessEntityContact] AS bec ON\n                                bec.[BusinessEntityID] = s.[BusinessEntityID] WHERE\n                                                                                   bec.[PersonID] = @PersonID)\n                INSERT INTO @retContactInformation\n                SELECT\n                    @PersonID,\n                    p.FirstName,\n                    p.LastName,\n                    ct.[Name],\n                    'Store Contact'\n                FROM  \n                    [Sales].[Store] AS s INNER JOIN\n                    [Person].[BusinessEntityContact] AS bec ON\n                         bec.[BusinessEntityID] = s.[BusinessEntityID] INNER JOIN\n                    [Person].ContactType AS ct ON\n                         ct.[ContactTypeID] = bec.[ContactTypeID] INNER JOIN\n                    [Person].[Person] AS p ON\n                         p.[BusinessEntityID] = bec.[PersonID] WHERE\n                                                                    bec.[PersonID] = @PersonID;\n            IF EXISTS (SELECT\n                           *\n                       FROM  \n                           [Person].[Person] AS p INNER JOIN\n                           [Sales].[Customer] AS c ON\n                                c.[PersonID] = p.[BusinessEntityID] WHERE\n                                                                         p.[BusinessEntityID] = @PersonID AND c.[StoreID] IS NULL)\n                INSERT INTO @retContactInformation\n                SELECT\n                    @PersonID,\n                    p.FirstName,\n                    p.LastName,\n                    NULL,\n                    'Consumer'\n                FROM  \n                    [Person].[Person] AS p INNER JOIN\n                    [Sales].[Customer] AS c ON\n                         c.[PersonID] = p.[BusinessEntityID] WHERE\n                                                                  p.[BusinessEntityID] = @PersonID AND c.[StoreID] IS NULL;\n        END\n    RETURN;\nEND",
  "xType": "TF",
  "type": "FUNCTION"
}