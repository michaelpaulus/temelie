{
  "definitionName": "uspLogError",
  "schemaName": "dbo",
  "definition": "-- uspLogError logs error information in the ErrorLog table about the \n-- error that caused execution to jump to the CATCH block of a \n-- TRY...CATCH construct. This should be executed from within the scope \n-- of a CATCH block otherwise it will return without inserting error \n-- information. \nCREATE PROCEDURE [dbo].[uspLogError] \n    @ErrorLogID [int] = 0 OUTPUT -- contains the ErrorLogID of the row inserted\nAS                               -- by uspLogError in the ErrorLog table\nBEGIN\n    SET NOCOUNT ON;\n\n    -- Output parameter value of 0 indicates that error \n    -- information was not logged\n    SET @ErrorLogID = 0;\n\n    BEGIN TRY\n        -- Return if there is no error information to log\n        IF ERROR_NUMBER() IS NULL\n            RETURN;\n\n        -- Return if inside an uncommittable transaction.\n        -- Data insertion/modification is not allowed when \n        -- a transaction is in an uncommittable state.\n        IF XACT_STATE() = -1\n        BEGIN\n            PRINT 'Cannot log error since the current transaction is in an uncommittable state. ' \n                + 'Rollback the transaction before executing uspLogError in order to successfully log error information.';\n            RETURN;\n        END\n\n        INSERT [dbo].[ErrorLog] \n            (\n            [UserName], \n            [ErrorNumber], \n            [ErrorSeverity], \n            [ErrorState], \n            [ErrorProcedure], \n            [ErrorLine], \n            [ErrorMessage]\n            ) \n        VALUES \n            (\n            CONVERT(sysname, CURRENT_USER), \n            ERROR_NUMBER(),\n            ERROR_SEVERITY(),\n            ERROR_STATE(),\n            ERROR_PROCEDURE(),\n            ERROR_LINE(),\n            ERROR_MESSAGE()\n            );\n\n        -- Pass back the ErrorLogID of the row inserted\n        SET @ErrorLogID = @@IDENTITY;\n    END TRY\n    BEGIN CATCH\n        PRINT 'An error occurred in stored procedure uspLogError: ';\n        EXECUTE [dbo].[uspPrintError];\n        RETURN -1;\n    END CATCH\nEND;",
  "xType": "P",
  "type": "PROCEDURE"
}