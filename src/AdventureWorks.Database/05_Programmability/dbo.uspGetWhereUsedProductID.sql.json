{
  "definitionName": "uspGetWhereUsedProductID",
  "schemaName": "dbo",
  "definition": "CREATE PROCEDURE [dbo].[uspGetWhereUsedProductID]\n@StartProductID INT, @CheckDate DATETIME\nAS\nBEGIN\n    SET NOCOUNT ON;\n    WITH   [BOM_cte] ([ProductAssemblyID], [ComponentID], [ComponentDesc], [PerAssemblyQty], [StandardCost], [ListPrice], [BOMLevel], [RecursionLevel])\n    AS     (SELECT\n                b.[ProductAssemblyID],\n                b.[ComponentID],\n                p.[Name],\n                b.[PerAssemblyQty],\n                p.[StandardCost],\n                p.[ListPrice],\n                b.[BOMLevel],\n                0\n            FROM  \n                [Production].[BillOfMaterials] AS b INNER JOIN\n                [Production].[Product] AS p ON\n                     b.[ProductAssemblyID] = p.[ProductID] WHERE\n                                                                b.[ComponentID] = @StartProductID AND @CheckDate >= b.[StartDate] AND @CheckDate <= ISNULL(b.[EndDate], @CheckDate)\n            UNION ALL\n            SELECT\n                b.[ProductAssemblyID],\n                b.[ComponentID],\n                p.[Name],\n                b.[PerAssemblyQty],\n                p.[StandardCost],\n                p.[ListPrice],\n                b.[BOMLevel],\n                [RecursionLevel] + 1\n            FROM  \n                [BOM_cte] AS cte INNER JOIN\n                [Production].[BillOfMaterials] AS b ON\n                     cte.[ProductAssemblyID] = b.[ComponentID] INNER JOIN\n                [Production].[Product] AS p ON\n                     b.[ProductAssemblyID] = p.[ProductID] WHERE\n                                                                @CheckDate >= b.[StartDate] AND @CheckDate <= ISNULL(b.[EndDate], @CheckDate))\n    SELECT\n        b.[ProductAssemblyID],\n        b.[ComponentID],\n        b.[ComponentDesc],\n        SUM(b.[PerAssemblyQty]) AS [TotalQuantity],\n        b.[StandardCost],\n        b.[ListPrice],\n        b.[BOMLevel],\n        b.[RecursionLevel]\n    FROM  \n        [BOM_cte] AS b GROUP BY\n                            b.[ComponentID], b.[ComponentDesc], b.[ProductAssemblyID], b.[BOMLevel], b.[RecursionLevel], b.[StandardCost], b.[ListPrice] ORDER BY\n                                                                                                                                                              b.[BOMLevel], b.[ProductAssemblyID], b.[ComponentID]\n    OPTION (MAXRECURSION 25);\nEND",
  "xType": "P",
  "type": "PROCEDURE"
}